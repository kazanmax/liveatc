<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Airport Ambient</title>
  <style>
    body {
      font-family: sans-serif;
      background: #222425;
      color: #ddd;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      gap: 20px;
      margin: 0;
    }
    iframe, audio { border: none; }
    .slider { width: 200px; }
    label { margin-top: 10px; }
  </style>

  <!-- ВАЖНО: сначала подключаем API плеера SoundCloud -->
  <script src="https://w.soundcloud.com/player/api.js" defer></script>
</head>
<body>
  <h1>Airport Ambient Radio</h1>

  <!-- SoundCloud embed (добавили id="sc-player") -->
  <iframe
    id="sc-player"
    width="400"
    height="300"
    scrolling="no"
    frameborder="no"
    allow="autoplay"
    src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/playlists/soundcloud%253Aplaylists%253A1573126828&color=%23ff5500&auto_play=true&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true">
  </iframe>

  <div style="font-size:10px;color:#ccc;line-break:anywhere;word-break:normal;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-family:Interstate,Lucida Grande,Lucida Sans Unicode,Lucida Sans,Garuda,Verdana,Tahoma,sans-serif;font-weight:100;">
    <a href="https://soundcloud.com/lostsounds-official/sets/deep-ambient" title="Deep Ambient" target="_blank" style="color:#ccc;text-decoration:none;">Deep Ambient</a>
  </div>

  <label for="scVolume">Ambient volume</label>
  <input type="range" class="slider" id="scVolume" min="0" max="1" step="0.01" value="0.5" />

  <!-- LiveATC -->
  <audio id="atc" controls autoplay loop>
    <source src="https://s1-fmt2.liveatc.net/unnt" type="audio/mpeg" />
    Ваш браузер не поддерживает аудио.
  </audio>

  <label for="atcVolume">LiveATC volume</label>
  <input type="range" class="slider" id="atcVolume" min="0" max="1" step="0.01" value="0.5" />

  <!-- Наш код — после разметки; ждём, пока DOM и API будут доступны -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      // ---- LiveATC громкость ----
      const atcAudio = document.getElementById('atc');
      const atcSlider = document.getElementById('atcVolume');

      // стартовое значение
      atcAudio.volume = parseFloat(atcSlider.value || '0.5');

      atcSlider.addEventListener('input', (e) => {
        const v = Math.min(1, Math.max(0, parseFloat(e.target.value)));
        atcAudio.volume = isNaN(v) ? 0.5 : v;
      });

      // ---- SoundCloud громкость через Widget API ----
      const scSlider = document.getElementById('scVolume');
      const scIframe = document.getElementById('sc-player');

      // Ждём, пока API загрузится (он подключён с defer, но на всякий случай)
      const initSC = () => {
        if (!window.SC || !SC.Widget) {
          // если API ещё не готов — пробуем чуть позже
          return setTimeout(initSC, 50);
        }

        const widget = SC.Widget(scIframe);

        // Важно дождаться готовности самого виджета
        widget.bind(SC.Widget.Events.READY, () => {
          // Устанавливаем стартовую громкость согласно слайдеру (API ждёт 0–100)
          const start = Math.round(parseFloat(scSlider.value || '0.5') * 100);
          widget.setVolume(isNaN(start) ? 50 : start);

          scSlider.addEventListener('input', (e) => {
            const v = Math.min(1, Math.max(0, parseFloat(e.target.value)));
            const vol0to100 = Math.round((isNaN(v) ? 0.5 : v) * 100);
            widget.setVolume(vol0to100);
          });
        });
      };

      initSC();
    });
  </script>
</body>
</html>
