<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Airport Ambient</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: sans-serif;
      background: #222425;
      color: #ddd;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      gap: 20px;
      margin: 0;
    :root{
      --bg:#222425; --fg:#ddd; --muted:#9aa0a3;
      --track:#2a2d2e; --track-edge:#121314; --glow:rgba(255,255,255,.08);
      --focus:rgba(120,200,255,.35); --thumb:#0e1112;
      --grid:rgba(255,255,255,.10);
      --accent-ambient:#ffb84d; --accent-ambient-glow:rgba(255,184,77,.45);
      --accent-atc:#3ee58e; --accent-atc-glow:rgba(62,229,142,.40);
      --accent-master:#7dd3fc; --accent-master-glow:rgba(125,211,252,.40);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      background:radial-gradient(1200px 600px at 50% -10%, rgba(255,255,255,0.06), transparent 55%), var(--bg);
      color:var(--fg);
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      gap:18px; padding:24px;
    }
    h1{margin:0 0 6px; font-weight:600; letter-spacing:.3px}

    .wrap{display:grid; gap:16px; width:min(820px, 94vw)}
    .row{display:flex; align-items:center; gap:12px; flex-wrap:wrap}
    .card{
      padding:14px 16px; border-radius:14px;
      background:rgba(255,255,255,.03);
      box-shadow:0 2px 0 rgba(0,0,0,.4), inset 0 1px 0 rgba(255,255,255,.04);
    }
    .sub{color:var(--muted); font-size:13px}

    /* ---------- Buttons ---------- */
    .btn{
      appearance:none; border:none; cursor:pointer;
      padding:8px 12px; border-radius:10px; font:inherit; color:#e8eef1;
      background:rgba(255,255,255,.05);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
      transition:transform .12s ease, box-shadow .12s ease, background .12s ease;
    }
    .btn:hover{ transform:translateY(-1px); }
    .btn:active{ transform:translateY(0); }
    .btn[aria-pressed="true"]{ background:rgba(255,80,80,.18); box-shadow:0 0 0 2px rgba(255,80,80,.25) inset; }
    .btn--small{ padding:6px 10px; font-size:14px }

    /* ---------- Slider Base ---------- */
    .slider{
      --accent:#00d07a; --accent-glow:rgba(0,208,122,.35);
      width:300px; max-width:80vw;
      appearance:none; height:42px; background:transparent; position:relative; cursor:pointer;
    }
    .slider:focus-visible{ outline:none; }

    /* grid ticks layer */
    .slider::before{
      content:""; position:absolute; left:0; right:0; top:50%; height:6px; transform:translateY(-50%);
      border-radius:999px;
      background:
        /* filled part (set via --fill) */
        linear-gradient(to right, var(--accent) var(--fill,0%), var(--track) var(--fill,0%)),
        /* ticks */
        repeating-linear-gradient(to right, transparent 0 28px, rgba(255,255,255,.12) 28px 29px, transparent 29px 58px),
        /* bottom edge line */
        linear-gradient(var(--track-edge), var(--track-edge));
      background-size:100% 6px, 100% 6px, 100% 1px;
      background-position:0 0, 0 0, 0 100%;
      background-repeat:no-repeat;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04), inset 0 1px 0 var(--glow);
    }

    /* thumb (WebKit) */
    .slider::-webkit-slider-thumb{
      appearance:none; width:18px; height:18px; margin-top:12px; /* center on 6px track in 42px box */
      border-radius:50%;
      background:
        radial-gradient(6px 6px at 50% 50%, white 0 2px, transparent 2px),
        linear-gradient(var(--thumb), var(--thumb));
      border:1px solid rgba(255,255,255,.08);
      box-shadow:0 0 0 3px rgba(0,0,0,.35), 0 0 18px -2px var(--accent-glow);
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .slider:hover::-webkit-slider-thumb{ transform:scale(1.02) }
    .slider:active::-webkit-slider-thumb{ transform:scale(0.98) }
    .slider:focus-visible::-webkit-slider-thumb{
      box-shadow:0 0 0 4px var(--focus), 0 0 18px -2px var(--accent-glow);
    }

    /* track (Firefox) — use the pseudo-element already; just keep thumb rules */
    .slider::-moz-range-track{ background:transparent; height:42px; }
    .slider::-moz-range-thumb{
      width:18px; height:18px; border-radius:50%;
      background:
        radial-gradient(6px 6px at 50% 50%, white 0 2px, transparent 2px),
        linear-gradient(var(--thumb), var(--thumb));
      border:1px solid rgba(255,255,255,.08);
      box-shadow:0 0 0 3px rgba(0,0,0,.35), 0 0 18px -2px var(--accent-glow);
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .slider:hover::-moz-range-thumb{ transform:scale(1.02) }
    .slider:active::-moz-range-thumb{ transform:scale(0.98) }
    .slider:focus-visible::-moz-range-thumb{ box-shadow:0 0 0 4px var(--focus), 0 0 18px -2px var(--accent-glow); }

    /* variants */
    .slider--ambient{ --accent:var(--accent-ambient); --accent-glow:var(--accent-ambient-glow); }
    .slider--atc{ --accent:var(--accent-atc); --accent-glow:var(--accent-atc-glow); }
    .slider--master{ --accent:var(--accent-master); --accent-glow:var(--accent-master-glow); }

    /* vertical layout for small screens */
    @media (max-width:560px){
      .stack-vertical{ display:grid; grid-template-columns: 1fr auto; align-items:center; gap:10px }
      .stack-vertical .slider{
        width:36vh; max-width:unset; transform:rotate(-90deg);
      }
      .stack-vertical .label{ order:-1 }
    }
    iframe, audio { border: none; }
    .slider { width: 200px; }
    label { margin-top: 10px; }
  </style>

  <!-- ВАЖНО: сначала подключаем API плеера SoundCloud -->
  <!-- SoundCloud API -->
  <script src="https://w.soundcloud.com/player/api.js" defer></script>
</head>
<body>
  <h1>Airport Ambient Radio</h1>
  <div class="wrap">

  <!-- SoundCloud embed (добавили id="sc-player") -->
  <iframe
    id="sc-player"
    width="400"
    height="300"
    scrolling="no"
    frameborder="no"
    allow="autoplay"
    src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/playlists/soundcloud%253Aplaylists%253A1573126828&color=%23ff5500&auto_play=true&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true">
  </iframe>

  <div style="font-size:10px;color:#ccc;line-break:anywhere;word-break:normal;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-family:Interstate,Lucida Grande,Lucida Sans Unicode,Lucida Sans,Garuda,Verdana,Tahoma,sans-serif;font-weight:100;">
    <a href="https://soundcloud.com/lostsounds-official/sets/deep-ambient" title="Deep Ambient" target="_blank" style="color:#ccc;text-decoration:none;">Deep Ambient</a>
  </div>
    <!-- MASTER -->
    <div class="card">
      <div class="row">
        <strong class="label">Master volume</strong>
        <input type="range" class="slider slider--master" id="masterVolume" min="0" max="1" step="0.01" value="0.6" />
        <button class="btn btn--small" id="masterMute" aria-pressed="false" title="Mute all">Mute</button>
        <button class="btn btn--small" id="pauseAll" aria-pressed="false" title="Pause/Resume all">Pause all</button>
      </div>
      <div class="sub">Управляет обоими источниками, изменения идут с мягким fade.</div>
    </div>

    <!-- Ambient / SoundCloud -->
    <div class="card">
      <iframe
        id="sc-player"
        width="100%"
        height="300"
        scrolling="no"
        allow="autoplay"
        src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/playlists/soundcloud%253Aplaylists%253A1573126828&color=%23ff5500&auto_play=true&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true">
      </iframe>

  <label for="scVolume">Ambient volume</label>
  <input type="range" class="slider" id="scVolume" min="0" max="1" step="0.01" value="0.5" />
      <div class="row stack-vertical" style="margin-top:8px">
        <span class="label">Ambient volume</span>
        <input type="range" class="slider slider--ambient" id="scVolume" min="0" max="1" step="0.01" value="0.5">
        <button class="btn btn--small" id="scMute" aria-pressed="false">Mute</button>
      </div>
    </div>

  <!-- LiveATC -->
  <audio id="atc" controls autoplay loop>
    <source src="https://s1-fmt2.liveatc.net/unnt" type="audio/mpeg" />
    Ваш браузер не поддерживает аудио.
  </audio>
    <!-- LiveATC -->
    <div class="card">
      <audio id="atc" controls autoplay loop style="width:100%">
        <source src="https://s1-fmt2.liveatc.net/unnt" type="audio/mpeg" />
        Ваш браузер не поддерживает аудио.
      </audio>

  <label for="atcVolume">LiveATC volume</label>
  <input type="range" class="slider" id="atcVolume" min="0" max="1" step="0.01" value="0.5" />
      <div class="row stack-vertical" style="margin-top:8px">
        <span class="label">LiveATC volume</span>
        <input type="range" class="slider slider--atc" id="atcVolume" min="0" max="1" step="0.01" value="0.5">
        <button class="btn btn--small" id="atcMute" aria-pressed="false">Mute</button>
      </div>
      <div class="sub">Если автоплей где-то блокируется — шевельните ползунок или нажмите Play.</div>
    </div>

  </div>

  <!-- Наш код — после разметки; ждём, пока DOM и API будут доступны -->
  <script>
    // ---------- small utils ----------
    const clamp01 = v => Math.min(1, Math.max(0, v));
    const toPct = v => `${Math.round(clamp01(v) * 100)}%`;
    const paintFill = (slider) => slider.style.setProperty('--fill', toPct(parseFloat(slider.value || '0')));
    const wait = (ms) => new Promise(r => setTimeout(r, ms));

    // Smooth volume ramp (source setter is a function receiving 0..1)
    async function fadeTo(setter, getCurrent, target, { duration = 250, steps = 12 } = {}){
      const from = clamp01(getCurrent());
      const to = clamp01(target);
      if (Math.abs(from - to) < 0.001){ setter(to); return; }
      const dt = duration / steps;
      for (let i = 1; i <= steps; i++){
        const t = i/steps;
        const v = from + (to - from) * t;
        setter(v);
        // eslint-disable-next-line no-await-in-loop
        await wait(dt);
      }
      setter(to);
    }

    window.addEventListener('DOMContentLoaded', () => {
      // ---- LiveATC громкость ----
      const atcAudio = document.getElementById('atc');
      // Elements
      const atcAudio  = document.getElementById('atc');
      const atcSlider = document.getElementById('atcVolume');
      const scSlider  = document.getElementById('scVolume');
      const master    = document.getElementById('masterVolume');

      const btnAtcMute = document.getElementById('atcMute');
      const btnScMute  = document.getElementById('scMute');
      const btnMasterMute = document.getElementById('masterMute');
      const btnPauseAll = document.getElementById('pauseAll');

      // стартовое значение
      atcAudio.volume = parseFloat(atcSlider.value || '0.5');
      // initial paints
      [master, atcSlider, scSlider].forEach(paintFill);

      // cached volumes for mute toggles
      let atcSaved = parseFloat(atcSlider.value || '0.5');
      let scSaved  = parseFloat(scSlider.value || '0.5');
      let masterSaved = parseFloat(master.value || '0.6');

      // ---- ATC: local audio ----
      atcAudio.volume = clamp01(atcSaved);
      atcSlider.addEventListener('input', (e) => {
        const v = Math.min(1, Math.max(0, parseFloat(e.target.value)));
        atcAudio.volume = isNaN(v) ? 0.5 : v;
        const v = clamp01(parseFloat(e.target.value));
        paintFill(atcSlider);
        atcSaved = v;
        fadeTo(x => atcAudio.volume = x, () => atcAudio.volume, v);
        // also nudge master visually to average (non-destructive)
        paintFill(master);
      });

      // ---- SoundCloud громкость через Widget API ----
      const scSlider = document.getElementById('scVolume');
      // ---- SoundCloud via Widget API ----
      const scIframe = document.getElementById('sc-player');
      let scWidget = null;
      let scCurrent = clamp01(scSaved);

      // Ждём, пока API загрузится (он подключён с defer, но на всякий случай)
      const initSC = () => {
        if (!window.SC || !SC.Widget) {
          // если API ещё не готов — пробуем чуть позже
          return setTimeout(initSC, 50);
        }

        const widget = SC.Widget(scIframe);

        // Важно дождаться готовности самого виджета
        widget.bind(SC.Widget.Events.READY, () => {
          // Устанавливаем стартовую громкость согласно слайдеру (API ждёт 0–100)
          const start = Math.round(parseFloat(scSlider.value || '0.5') * 100);
          widget.setVolume(isNaN(start) ? 50 : start);
      function setScVol01(v01){
        scCurrent = clamp01(v01);
        if (scWidget) scWidget.setVolume(Math.round(scCurrent * 100));
      }

      const initSC = () => {
        if (!window.SC || !SC.Widget) return setTimeout(initSC, 50);
        scWidget = SC.Widget(scIframe);
        scWidget.bind(SC.Widget.Events.READY, () => {
          setScVol01(scCurrent);
          scSlider.addEventListener('input', (e) => {
            const v = Math.min(1, Math.max(0, parseFloat(e.target.value)));
            const vol0to100 = Math.round((isNaN(v) ? 0.5 : v) * 100);
            widget.setVolume(vol0to100);
            const v = clamp01(parseFloat(e.target.value));
            paintFill(scSlider);
            scSaved = v;
            fadeTo(setScVol01, () => scCurrent, v);
            paintFill(master);
          });
        });
      };

      initSC();

      // ---- MASTER ----
      function getAtc(){ return clamp01(atcAudio.volume); }
      function getSc(){ return clamp01(scCurrent); }
      function setAtc(v){ atcAudio.volume = clamp01(v); }
      function setSc(v){ setScVol01(v); }

      // master applies proportionally to each channel relative to its own slider value
      master.addEventListener('input', async (e) => {
        const m = clamp01(parseFloat(e.target.value));
        paintFill(master);
        masterSaved = m;
        const atcTarget = clamp01(atcSlider.value * m);
        const scTarget  = clamp01(scSlider.value * m);
        // run fades concurrently
        fadeTo(setAtc, getAtc, atcTarget);
        fadeTo(setSc,  getSc,  scTarget);
      });

      // ---- MUTES ----
      btnAtcMute.addEventListener('click', () => {
        const pressed = btnAtcMute.getAttribute('aria-pressed') === 'true';
        if (pressed){
          btnAtcMute.setAttribute('aria-pressed','false');
          fadeTo(setAtc, getAtc, atcSaved * masterSaved);
        } else {
          btnAtcMute.setAttribute('aria-pressed','true');
          fadeTo(setAtc, getAtc, 0);
        }
      });

      btnScMute.addEventListener('click', () => {
        const pressed = btnScMute.getAttribute('aria-pressed') === 'true';
        if (pressed){
          btnScMute.setAttribute('aria-pressed','false');
          fadeTo(setSc, getSc, scSaved * masterSaved);
        } else {
          btnScMute.setAttribute('aria-pressed','true');
          fadeTo(setSc, getSc, 0);
        }
      });

      btnMasterMute.addEventListener('click', () => {
        const pressed = btnMasterMute.getAttribute('aria-pressed') === 'true';
        if (pressed){
          btnMasterMute.setAttribute('aria-pressed','false');
          fadeTo(setAtc, getAtc, atcSaved * masterSaved);
          fadeTo(setSc,  getSc,  scSaved  * masterSaved);
        } else {
          btnMasterMute.setAttribute('aria-pressed','true');
          fadeTo(setAtc, getAtc, 0);
          fadeTo(setSc,  getSc,  0);
        }
      });

      // ---- Pause all ----
      btnPauseAll.addEventListener('click', () => {
        const pressed = btnPauseAll.getAttribute('aria-pressed') === 'true';
        if (pressed){
          btnPauseAll.setAttribute('aria-pressed','false');
          atcAudio.play().catch(()=>{});
          if (scWidget && scWidget.play) scWidget.play();
        } else {
          btnPauseAll.setAttribute('aria-pressed','true');
          atcAudio.pause();
          if (scWidget && scWidget.pause) scWidget.pause();
        }
      });

      // repaint fills on first tick (ensures CSS var applied)
      requestAnimationFrame(() => {
        [master, atcSlider, scSlider].forEach(paintFill);
      });
    });
  </script>
</body>
